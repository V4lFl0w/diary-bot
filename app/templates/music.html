<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DiaryBot ‚Ä¢ Music</title>
  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial; background:#0b0f19; color:#e8eefc; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 24px 18px 40px; }
    .card { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.10); border-radius: 16px; padding: 16px; box-shadow: 0 8px 30px rgba(0,0,0,.25); }
    h1 { font-size: 22px; margin: 0 0 10px; }
    p { margin: 0 0 14px; opacity: .9; line-height: 1.35; }
    .grid { display:grid; grid-template-columns: 1fr; gap: 10px; }
    .btn { display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 14px 14px; border-radius: 14px; text-decoration:none; color:inherit;
      background: rgba(255,255,255,.07); border: 1px solid rgba(255,255,255,.12);
    }
    .btn:hover { background: rgba(255,255,255,.10); }
    .tag { font-size: 12px; opacity: .75; }
    .footer { margin-top: 14px; font-size: 12px; opacity: .7; }
    code { background: rgba(255,255,255,.08); padding: 2px 6px; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üéµ Music</h1>
      <p>–§—É–Ω–¥–∞–º–µ–Ω—Ç –≥–æ—Ç–æ–≤. –í –±–æ—Ç–µ: <code>/music</code> ‚Üí –ø–æ–∏—Å–∫ ‚Üí –ø—Ä–µ–≤—å—é ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.</p>

      <div class="grid">
        <a class="btn" href="/pay"><span>üíé –ü—Ä–µ–º–∏—É–º</span><span class="tag">–æ–ø–ª–∞—Ç–∞</span></a>
        <a class="btn" href="https://t.me/"><span>ü§ñ –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞</span><span class="tag">Telegram</span></a>
      </div>

      <div class="footer">
        –î–∞–ª—å—à–µ —Ä–∞—Å—à–∏—Ä–∏–º: –ø–∞–≥–∏–Ω–∞—Ü–∏—è, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, ‚Äú–º–æ—ë/–∏–∑ –ø–æ–∏—Å–∫–∞‚Äù, –≤–µ–±-–ø–ª–µ–π–ª–∏—Å—Ç, —É–¥–∞–ª–µ–Ω–∏–µ.
      </div>
    </div>
  </div>

<!-- TG DEBUG UI (injected) -->
<style>
  .tgdbg-btn{position:fixed;right:14px;bottom:14px;z-index:99999;background:#1f2937;color:#fff;border:none;border-radius:14px;padding:10px 12px;font-weight:700;box-shadow:0 10px 30px rgba(0,0,0,.25);opacity:.92}
  .tgdbg-btn:active{transform:translateY(1px)}
  .tgdbg-panel{position:fixed;left:10px;right:10px;bottom:64px;z-index:99999;background:rgba(17,24,39,.98);color:#e5e7eb;border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:12px;display:none}
  .tgdbg-row{display:flex;gap:8px;align-items:center;margin-bottom:8px;flex-wrap:wrap}
  .tgdbg-inp{flex:1;min-width:180px;background:rgba(255,255,255,.06);color:#fff;border:1px solid rgba(255,255,255,.14);border-radius:12px;padding:10px 12px;outline:none}
  .tgdbg-a{background:#2563eb;color:#fff;border:none;border-radius:12px;padding:10px 12px;font-weight:700}
  .tgdbg-b{background:#059669;color:#fff;border:none;border-radius:12px;padding:10px 12px;font-weight:700}
  .tgdbg-c{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.18);border-radius:12px;padding:10px 12px;font-weight:700}
  .tgdbg-pre{white-space:pre-wrap;word-break:break-word;background:rgba(0,0,0,.25);border-radius:12px;padding:10px;max-height:40vh;overflow:auto;font-size:12px;line-height:1.35}
</style>

<button id="tgdbgBtn" class="tgdbg-btn" type="button">TG DEBUG</button>
<div id="tgdbgPanel" class="tgdbg-panel">
  <div class="tgdbg-row">
    <input id="tgdbgQ" class="tgdbg-inp" placeholder="–ó–∞–ø—Ä–æ—Å –¥–ª—è TG-search (–Ω–∞–ø—Ä–∏–º–µ—Ä: Kizaru - XXL Freestyle)" />
  </div>
  <div class="tgdbg-row">
    <button id="tgdbgTest" class="tgdbg-a" type="button">TEST</button>
    <button id="tgdbgSend" class="tgdbg-b" type="button">TEST+SEND</button>
    <button id="tgdbgClose" class="tgdbg-c" type="button">CLOSE</button>
  </div>
  <div class="tgdbg-row" style="opacity:.85;font-size:12px">
    <span>TEST = —Ç–æ–ª—å–∫–æ –ø–æ–∏—Å–∫; TEST+SEND = –ø–æ–∏—Å–∫ + copyMessage –≤ —Ç–≤–æ–π —á–∞—Ç</span>
  </div>
  <pre id="tgdbgOut" class="tgdbg-pre">{}</pre>
</div>

<script>
(function(){
  function getTgId(){
    try{
      const u = new URL(window.location.href);
      const v = u.searchParams.get("tg_id");
      if(v) return v;
    }catch(e){}
    // fallback: –µ—Å–ª–∏ –µ—Å—Ç—å Telegram WebApp
    try{
      const id = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
      if(id) return String(id);
    }catch(e){}
    return "";
  }

  async function callTgTest(send){
    const q = (document.getElementById("tgdbgQ").value || "").trim();
    const tgId = getTgId();
    const out = document.getElementById("tgdbgOut");
    if(!q){ out.textContent = "ERR: empty query"; return; }
    if(!tgId){ out.textContent = "ERR: tg_id missing in URL and Telegram initData"; return; }

    const url = "/webapp/music/api/tg_test?q=" + encodeURIComponent(q) + "&tg_id=" + encodeURIComponent(tgId) + "&send=" + (send? "1":"0");
    out.textContent = "Loading...\n" + url;

    try{
      const r = await fetch(url, {method:"GET"});
      const data = await r.json().catch(()=>({raw:"non-json"}));
      out.textContent = JSON.stringify({status:r.status, data}, null, 2);
    }catch(e){
      out.textContent = "FETCH_ERR: " + (e && e.message ? e.message : String(e));
    }
  }

  const btn = document.getElementById("tgdbgBtn");
  const panel = document.getElementById("tgdbgPanel");
  const close = document.getElementById("tgdbgClose");
  const test = document.getElementById("tgdbgTest");
  const send = document.getElementById("tgdbgSend");

  btn.addEventListener("click", ()=>{ panel.style.display = (panel.style.display==="block" ? "none" : "block"); });
  close.addEventListener("click", ()=>{ panel.style.display = "none"; });
  test.addEventListener("click", ()=>callTgTest(false));
  send.addEventListener("click", ()=>callTgTest(true));
})();
</script>
<!-- /TG DEBUG UI -->

</body>
</html>
